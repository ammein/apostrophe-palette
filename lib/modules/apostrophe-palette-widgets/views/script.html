{% macro newRule(value, fieldSchema) %}
  {%- if fieldSchema.selector and (value !== null or value !== undefined) -%}
    {%- if apos.global.aposPaletteIsArray(fieldSchema.property) -%}
      {%- for property in fieldSchema.property -%}
        {% if fieldSchema.mediaQuery %}@media {{ fieldSchema.mediaQuery }} { {% endif %} {{ fieldSchema.selector }} { {{ property }}: {{ value }}{% if fieldSchema.unit %}{{ fieldSchema.unit }}{% endif %}; } {% if fieldSchema.mediaQuery %}} {% endif %}
      {%- endfor -%}
    {%- else -%}
      {% if fieldSchema.mediaQuery %}@media {{ fieldSchema.mediaQuery }} { {% endif %} {{ fieldSchema.selector }} { {{ fieldSchema.property }}: {{ value }}{% if fieldSchema.unit %}{{ fieldSchema.unit }}{% endif %}; } {% if fieldSchema.mediaQuery %}} {% endif %}
    {%- endif -%}
  {%- endif -%}
{% endmacro %}

{% macro tag(apos, global) %}
  <style id="apos-palette-styles" data-apos-palette-styles>
    {%- for key, value in global -%}
      {% set fieldSchema = apos.global.aposPaletteGetFieldSchema(key)  %}
      {%- if (fieldSchema) -%}
        {{ newRule(value, fieldSchema) }}
      {%- endif -%}
    {% endfor %}
  </style>
{% endmacro %}