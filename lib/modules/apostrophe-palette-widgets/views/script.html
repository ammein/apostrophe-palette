{% macro newRule(value, fieldSchema) %}
  {%- if fieldSchema.selector and value -%}
    {%- if apos.global.aposPaletteIsArray(fieldSchema.property) -%}
      {%- for property in fieldSchema.property -%}
        {{ fieldSchema.selector }} { {{ property }}: {{ value }}{% if fieldSchema.unit %}{{ fieldSchema.unit }}{% endif %}; }
      {%- endfor -%}
    {%- else -%}
      {{ fieldSchema.selector }} { {{ fieldSchema.property }}: {{ value }}{% if fieldSchema.unit %}{{ fieldSchema.unit }}{% endif %}; }
    {%- endif -%}
  {%- endif -%}
{% endmacro %}

{% macro tag(apos, global) %}
  <style id="apos-palette-styles" data-apos-palette-styles>
    {%- for key, value in global -%}
      {% set fieldSchema = apos.modules['apostrophe-global'].aposPaletteGetFieldSchema(key)  %}
      {%- if (fieldSchema) -%}
        {{ newRule(value, fieldSchema) }}
      {%- endif -%}
    {% endfor %}
  </style>
{% endmacro %}